(function(){Nokia.Scroll=Nokia.Widget.extend({initialize:function(b){var a=this;var d={increase:100,duration:200,scrollBar:true,showArrows:false,bottomImage:true};a.options=jQuery.extend(d,b);a._super.apply(a,[a.options]);var c=a.options.element?jQuery(a.options.element):(jQuery.browser.mozilla?jQuery("html"):jQuery("body"));a.element=c;a.isBody=(/(html|body)/).test(c[0].tagName.toLowerCase());a.pixelFix=jQuery.browser.mozilla?1:0;a.document=jQuery(document);a.window=jQuery(window);if(a.options.showArrows){a.arrowUp=a._createArrow(a.Directions.UP);a.arrowDown=a._createArrow(a.Directions.DOWN);a._positionArrows()}if(a.options.scrollBar){a._createScrollBar();a._updateScrollBarPosition()}if(a.options.bottomImage){var e=Nokia.dom.parseHTML('<div class="ui-widget-overlay" style="height: 100px; position: relative;"></div>');Nokia.dom.append(c,e)}a._scrollListener();a.scrollHeight=a.isBody?a.document.height():c[0].scrollHeight;a.scrollTop=a.isBody?a.window.scrollTop():c.scrollTop();a._attachEvents();setInterval(function(){if(!a._hasScrolled()){return}a._scrollListener();if(a.options.showArrows){a._positionArrows()}if(a.options.scrollBar){a._updateScrollBar();a._updateScrollBarPosition()}},100);a.registerVibrationOn(["create","scroll"]);a.fireCallback("create")},_attachEvents:function(){var a=this,b=a.options,c=a.isBody?a.window:a.element;window.addEventListener("resize",function(){a._scrollListener();if(b.showArrows){a._positionArrows()}if(b.scrollBar){a._updateScrollBar();a._updateScrollBarPosition()}},false);c.bind("scroll",function(){a._scrollListener();if(b.scrollBar){a._updateScrollBar()}})},_createArrow:function(e){var a=this,b=a.options,c=a.element;var d=Nokia.dom.parseHTML('<a href="javascript:void(0);" class="nokia-scroll-arrow nokia-scroll-arrow-'+e+'"></a>');d.click(function(){var f="nokia-scroll-arrow-"+e+"-active";d.addClass(f);a.scroll(e,function(){d.removeClass(f)})});Nokia.dom.append(c,d);return d},_createScrollBar:function(){var a=this,b=a.element;a.barWrapper=Nokia.dom.parseHTML('<div class="ui-state-default nokia-scroll-wrapper"></div>');a.roller=Nokia.dom.parseHTML('<div class="ui-state-active nokia-scroll-roller"></div>');Nokia.dom.append(a.barWrapper,a.roller);Nokia.dom.append(b,a.barWrapper);a.rollerHeight=a.roller.height()},_getScrollPercent:function(){var b=this,c=b.isBody?b.window:b.element,a=b.isBody?window.innerHeight:c.height();return(c.scrollTop()/((b.isBody?b.document.height():c[0].scrollHeight)-a))},_hasScrolled:function(){var a=this;var c=a.isBody?a.document.height():a.element[0].scrollHeight;var d=a.isBody?a.window.scrollTop():a.element.scrollTop();var b=!(d==a.scrollTop&&c==a.scrollHeight);a.scrollHeight=c;a.scrollTop=d;return b},_positionArrows:function(){var b=this,c=b.element,d=c.width(),a=b.isBody?window.innerHeight:c.height();b.arrowUp.css({left:c.offset().left+d-41,top:(b.isBody?0:c.offset().top)+5});b.arrowDown.css({left:c.offset().left+d-41,top:(b.isBody?window.innerHeight:c.offset().top+a)-41});b.arrowUp.css("position",b.isBody?"fixed":"absolute");b.arrowDown.css("position",b.isBody?"fixed":"absolute")},_scrollListener:function(){var b=this;options=b.options;var a=b.isBody?window.innerHeight:b.element.height();var d=b.isBody?b.document.height():b.element[0].scrollHeight;var e=b.isBody?b.window.scrollTop():b.element.scrollTop();var c=e<=0;var f=d-(e+a)<=0;if(options.showArrows){b.showArrows();if(c){b.hideArrows(b.arrowUp)}if(f){b.hideArrows(b.arrowDown)}}if((c&&f)&&options.scrollBar){b.barWrapper.hide()}else{b.barWrapper.show()}},_updateScrollBar:function(){var a=this,b=a._getScrollPercent()||0;a.roller.css({top:(b*(a.barWrapperHeight-a.rollerHeight))})},_updateScrollBarPosition:function(){var b=this,c=b.options,f=b.element.offset(),e=b.isBody?0:f.top,d=b.isBody?0:window.innerWidth-(f.left+b.element.outerWidth()),a=b.isBody?window.innerHeight:b.element.outerHeight();if(!c.showArrows){b.barWrapper.css({height:a-2,top:e,right:d})}else{b.barWrapper.css({height:a-92,right:d+(b.isBody?15:17),top:e+46})}b.barWrapperHeight=b.barWrapper.height();if(b.isBody){b.barWrapper.css("position","fixed")}else{b.barWrapper.css("position","absolute")}},hideArrows:function(b){var a=this;if(b){b.hide()}else{a.arrowUp.hide();a.arrowDown.hide()}},scroll:function(e,g){var a=this,b=a.options,c=a.element,f=b.increase,d=b.duration;f=f*(e==a.Directions.UP?-1:1);c.animate({scrollTop:"+="+f},d,function(){if(g){g.apply(a,[])}a.fireCallback("scroll")})},showArrows:function(b){var a=this;if(b){b.show()}else{a.arrowUp.show();a.arrowDown.show()}},Styles:{arrowClass:"nokia-scroll-arrow",activeClass:"nokia-scroll-arrow-active",disabledClass:"nokia-scroll-disabled"},Directions:{UP:"up",DOWN:"down"}})})();