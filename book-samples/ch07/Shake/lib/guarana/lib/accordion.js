(function(){Nokia.Accordion=Nokia.Widget.extend({initialize:function(b){var a=this;var c={event:"click",header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},multiple:true,collapsible:true,closed:false};a.options=jQuery.extend(c,b);a._super.apply(a,[a.options]);a.registerData("accordion");a._applyStyle();a._attachEvents();a.registerVibrationOn(["toggle"]);a.fireCallback("create")},_attachEvents:function(){var a=this;var c=a.element;var b=a.options;a.headers.unbind("mousedown.accordion");a.headers.unbind("keypress.accordion");a.headers.bind("focus.accordion",function(){var d=jQuery(this).next().is(":visible");if(d){jQuery(this).removeClass([a.Styles.stateActive].join(" "))}jQuery(this).addClass([a.Styles.stateHover].join(" "))});a.headers.bind("blur.accordion",function(){var d=jQuery(this).next().is(":visible");if(d){jQuery(this).addClass([a.Styles.stateActive].join(" "))}else{jQuery(this).addClass([a.Styles.stateDefault].join(" "))}jQuery(this).removeClass([a.Styles.stateHover].join(" "))});a.headers.hover(function(){jQuery(this).trigger("focus.accordion")},function(){jQuery(this).trigger("blur.accordion")});a.headers.bind("click.accordion",function(d){a.toggle(this,d)});Nokia.util.bindEnter(a.headers,function(d){a.toggle(this,d)})},toggleClass:function(d,c){var b=d.indexOf(c)>-1,a;if(b){a=d.replace(c,"")}else{a=[d,c].join(" ")}return a},toggle:function(f,a){var k=this;var e=k._findActive(f);var l=e[0];var g=e.next();var b=g[0];var m=k.options;var i=g.is(":visible");if(i&&(m.collapsible==false)){if(k.getActiveContents().length==1){return false}}if(m.multiple==false){var d=k.closeAll();if(i&&d.length==1){return false}}var h=e.find(".ui-icon");var j=h[0];if(!i){j.className=["ui-icon",m.icons.headerSelected].join(" ")}else{j.className=["ui-icon",m.icons.header].join(" ")}b.className=k.toggleClass(b.className,k.Styles.accordionContentActive);if(!e.hasClass(k.Styles.stateHover)){l.className=k.toggleClass(l.className,k.Styles.stateActive);l.className=k.toggleClass(l.className,k.Styles.stateDefault)}var c=i?"close":"open";k.fireCallback(c,a,e,g);k.fireCallback("toggle",a,e,g)},closeAll:function(){var b=this;var c=b.options;var a=b.getActiveHeaders();var f=a.next();var e=a.find(".ui-icon");for(var d=0;d<a.length;d++){a[d].className=[b.Styles.stateDefault,b.Styles.cornerAll,b.Styles.helperReset,b.Styles.accordionHeader].join(" ");f[d].className=[b.Styles.accordionContent,b.Styles.helperReset,b.Styles.widgetContent,b.Styles.cornerBottom].join(" ");e[d].className=[c.icons.header,"ui-icon"].join(" ")}return f},getActiveContents:function(){var a=this;return a.contents.filter("."+a.Styles.accordionContentActive)},getActiveHeaders:function(){var a=this;return a.headers.filter("."+a.Styles.stateActive)},_findActive:function(b){var a=this;var c=null;var d=a.headers;if(b){if(typeof b=="number"){c=d.filter(":eq("+b+")")}else{c=d.not(d.not(b))}}else{if(b===false){c=jQuery([])}else{c=d.filter(":eq(0)")}}return c},_applyStyle:function(){var b=this;var e=b.element;var c=b.options;e.addClass([b.Styles.accordion,b.Styles.widget,b.Styles.helperReset].join(" "));if(e[0].nodeName.toLowerCase()=="ul"){var d=e.children("li");d.addClass(b.Styles.accordionLIFix)}b.headers=e.find(c.header);var h=b.headers;h.addClass([b.Styles.accordionHeader,b.Styles.helperReset,b.Styles.stateDefault,b.Styles.cornerAll].join(" "));var f=h.next();f.addClass([b.Styles.accordionContent,b.Styles.helperReset,b.Styles.widgetContent,b.Styles.cornerBottom].join(" "));var g=this._findActive(b.active||c.active);g.addClass(b.Styles.cornerAll);g.toggleClass(b.Styles.cornerTop);b.headers.each(function(){var j=this;var i=Nokia.dom.parseHTML('<span class="ui-icon '+c.icons.header+'"></span>');Nokia.dom.prepend(j,i)});b.contents=b.headers.next();if(!c.closed||!c.collapsible){g.toggleClass(b.Styles.stateDefault);g.toggleClass(b.Styles.stateActive);g.next().addClass(b.Styles.accordionContentActive);var a=g.find(".ui-icon");a.toggleClass(c.icons.header);a.toggleClass(c.icons.headerSelected)}},Styles:{accordion:"ui-accordion",accordionContent:"ui-accordion-content",accordionContentActive:"ui-accordion-content-active",accordionHeader:"ui-accordion-header",accordionLIFix:"ui-accordion-li-fix",cornerAll:"ui-corner-all",cornerBottom:"ui-corner-bottom",cornerTop:"ui-corner-top",helperReset:"ui-helper-reset",stateActive:"ui-state-active",stateDefault:"ui-state-default",stateHover:"ui-state-hover",widget:"ui-widget",widgetContent:"ui-widget-content"}})})();